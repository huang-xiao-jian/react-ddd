## 参与者

- 扫描专员，负责扫描实体证件，集中上传系统
- 理赔专员，负责审核报案信息
  - 例如：审核附件池是否满足理赔要求

## 业务概念

- 附件类别
  - 用户上传附件
  - 系统生成附件（一般对应结案通知类别）

- 附件类型
  - 身份证
  - 医疗报告
  - 疾病诊断证明
  - 交通事故定责书
  
- 附件类型类别
  - 附件类型对应文件数量可能为：`1:1` | `1:N`，附件类型  `1:N`时，逻辑上为附件组
  - 例如：
    - 报案人身份证关系为：`1:1` 
    - 医疗记录关系为：`1:N`
- 附件类型清单
  - 系统业务支持的附件类型

- 附件需求清单
  - 根据报案信息、保单信息，案件具体需要的附件类型集合

- 附件池
  - 用户实际上传的文件集合

- 复合附件 - 单个文件里包含多个附件，实际情况比纯理论设计复杂
  - 例如：多人的身份证同一个 `pdf` 文件中

## 业务用例

- 支持上传附件
- 支持上传复合附件
- 支持案件内引用存量附件
  - 本质上为案件内的附件复用
  - 场景描述
    - 例如：案件报案人、出险人、受益人为同一人，身份证文件仅需上传一次，后续引用附件即可
    - 例如：案件报案人、出险人、受益人身份证文件包含在复合文件内
- 支持用户修改附件类型
  - 本质上为案件内部附件的 `Transfer`
- 支持用户修改附件说明信息
  - 例如：`1~2` 报案人身份证，`3~4` 为出险人身份证

- 支持案件池内部使用存量附件
  - 本质上为案件池对应的附件复用
  - 场景描述
    - 文件上传到错误的案件，需要执行案件池内部附件的 `Transfer`
      - 例如：交通事故，同时触发医疗、身故、车损条款，拆分多个子案件后，医疗凭证错误上传到身故案件。
    - 保险条款复杂，拆分多个子案件，重复附件需求，只需要上传一次，本质上为案件池内部的 `Duplicate`
    - 用户存在历史出险，允许直接复用，本质上为案件池内部的 `Duplicate`（缓存刷新规则暂不考虑）
      - 例如：交通事故，马路杀手一年能出十几次险

## 业务规则

### 上传附件

- 选择文件类型限制为：`PDF | DOC | XSL | PNG | JPG`
  - **特别说明：文件类型限制存在变化，统一服务端进行控制**

- 附件类型选择为自由模式，用户在系统预设范围内随意选择
- 附件类型类别选择，区分 `Group` | `Single` 类型，选择互斥
- 附件类型至少选择一项，支持多选
- 案件内附件引用，上传附件时关联多附件类型即可。
  - 建立关联关系后，逻辑上判定对应的文档类型已上传
- 案件执行阶段判断附件池是否满足理赔需求
  - 允许手动修改（纯线下对接，允许系统走非标流程）

### 附件操作

- 系统自动生成的文件，控制权完全交由系统，用户不能执行操作
- 附件上传、删除为批量动作，仅在用户确认时执行

### 附件复用

- 附件复用限制操作者具备相关权限
  - `TODO`: 细节未定
- 附件转移（`Transfer`），解除原始附件引用
  - 适用于上传错误的场景
- 附件复制（`Duplicate`），保留原始附件引用
  - 适用于减少文件上传的场景，例如：报案人身份证，多个新案件存在引用
- 附件转移、附件复制执行操作前需要进行二次确认
- 附件转移（`Transfer`），附件复制（`Duplicate`）允许多目标案件
- 附件复用目标案件预设匹配条件
  - `Application No`
  - `Case No`
  - `Loss Party ID`

### 上传复合附件

解决方案一

- 用户在不同附件类型内分别上传
- 上传后需要添加说明信息
  - 例如：第一页为报案人身份证，第二页为受益人身份证

解决方案二

- 用户在特定附件类型内上传
- 附件上传后调参
  - 添加说明信息（同方案一）
  - 关联同级附件类型，逻辑上判定为关联附件类型已上传

**暂定解决方案**：

- 文件上传与附件类型分离，用户自行决定文件的附件类型
- 文件上传时添加说明信息（同方案一）

## 业务视图规则

- 特定时间，仅允许最多为一个附件添加注释信息
- 若存在文件处于上传中状态，不允许提交数据
- 若尚未上传文件，不允许提交数据
- **用户重复选择同一文件，暂时不做任何处理**

## 基础设施层规则

- 上传附件时，若附件类型类别为 `Group`，需要客户端生成唯一 `Group ID`



